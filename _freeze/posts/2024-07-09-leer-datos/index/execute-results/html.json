{
  "hash": "a39c9f5e7160b6400ea6d9d57dc24b18",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Acceso a Datos\"\nauthor: \"Miguel Equihua\"\ndate: 9/jul/2024\n\nlang: es\ncategories: [datos, datos abiertos, API]\n\nimage: magnifying-glass-541626_1280.jpg\n\ncode-fold: true\n\nlightbox: true\n---\n\n\n\n\n## Datos en Mi equipo\n\nObviamente, la forma más sencilla de acceder a datos es cuando los tenemos en nuestro propio equipo. En este caso lo usual es que sea alguno de los formatos de Microsoft (Word o Excel) o algún formato genérico como los identificados como **txt** (_texto plano_) o **csv** (_valores separados por comas_). Puuede haber otras variantes de archivos de datos, como **kml**, **GeoJason**, **GeoTIFF** o **shp** (_shape file_) usuales en la gestión de _datos geográficos_. En Genómica está el formato **fasta**, que también cuenta con bibliotecas adecuadas en _R_. Hay una correspondiente variedad de recursos para leer todos estos tipos de datos en _R_ así como para analizarlos y preparar resúmenes, modelos y gráficos de interés. A continuación veremos algunos ejemplos sencillos para tener una idea del proceso general.\n\nPara nuestros fines didácticos ya hemos visto como podemos interactuar con documentos de tipo texto plano. Ahora quisiera que vieramos como leer datos de Excel y de Word.\n\n### Datos Excel\n\nTengo este archivo de datos obtenidos por D.L. Cunningham de la Universidad de Cornell. Son registros de masa corporal (g) de pollos de acuerdo con su posición en la _jerarquía de picotazos_.  Veamos los datos.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuppressPackageStartupMessages(library(tidyverse))\nlibrary(ggplot2)\nlibrary(readxl)\npollos_peso <- read_excel(\"datos/peck_odr.xls\", skip = 2)\n```\n:::\n\n\n\n\nlos datos están un formato poco conveniente para un análisis general. Hagamos algunas operaciones para ponerlos en una forma más adecuada\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npollos_peso <- pollos_peso %>%\n                 rename(jerarquia = `Jerarquía\\npor picoteo`) %>% \n                 pivot_longer(cols = `Gallinero 1`:`Gallinero 7`, \n                              names_to = \"gallinero\",\n                              values_to = \"peso\") %>% \n                 mutate(gallinero = factor(gallinero),\n                        jerarquia = as.integer(jerarquia))\n\nggplot(pollos_peso, aes(x = jerarquia, y = peso)) +\n  geom_point(color = \"orange\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n\n\n¿qué análisis sugieres habría que hacer ahora?\n\n\n### Datos en word\n\nUtilizo la bibliotec **docxtractr** para extraer las tablas contenidas en el documento Word (en versión *docx*). Hay que cargar el documento y luego extraer las tablas, una por una. Lo primero que recuperé es la tabla de *Colonia Olmeca*.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(flextable)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'flextable'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following object is masked from 'package:purrr':\n\n    compose\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(docxtractr)\n\ndocx <- list.files(\"datos/\", pattern = \"^A.*docx$\", full.names = TRUE)\ndocx <- read_docx(docx)\n\nnombre_vars <-c(\"sp\", \"alt\", \"dens_rel\", \"frec_rel\", \"cob_rel\", \"ivi\") \n\n# Olmeca\narboles <- docx_extract_tbl(docx = docx, tbl_number = 1, header = TRUE)\nolmeca <- arboles %>% \n          assign_colnames(row = 1) %>% \n          mutate_at(2:6, as.numeric) %>% \n          filter(!row_number() %in% (length(arboles[[1]]) - 1))\n\nnames(olmeca) <- nombre_vars\n\nolmeca %>% \n  flextable() %>% \n  set_header_labels(sp = \"\\n\\nEspecie\", \n                    alt = \"Altura\\npromedio\\n(m)\",\n                    dens_rel = \"Densidad\\nRelativa\\n(%)\",\n                    frec_rel = \"Frecuencia\\nRelativa\\n(%)\",\n                    cob_rel = \"Cobertura\\nRelativa\\n(%)\",\n                    ivi = \"Valor\\nde Importancia\\n(%)\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-0bf2c1a4{}.cl-0bde4db4{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-0be5e8a8{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-0be5e8bc{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-0be61486{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0be61490{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0be61491{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0be6149a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0be614a4{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0be614a5{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-0bf2c1a4'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-0be61486\"><p class=\"cl-0be5e8a8\"><br><br><span class=\"cl-0bde4db4\">Especie</span></p></th><th class=\"cl-0be61490\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">Altura</span><br><span class=\"cl-0bde4db4\">promedio</span><br><span class=\"cl-0bde4db4\">(m)</span></p></th><th class=\"cl-0be61490\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">Densidad</span><br><span class=\"cl-0bde4db4\">Relativa</span><br><span class=\"cl-0bde4db4\">(%)</span></p></th><th class=\"cl-0be61490\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">Frecuencia</span><br><span class=\"cl-0bde4db4\">Relativa</span><br><span class=\"cl-0bde4db4\">(%)</span></p></th><th class=\"cl-0be61490\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">Cobertura</span><br><span class=\"cl-0bde4db4\">Relativa</span><br><span class=\"cl-0bde4db4\">(%)</span></p></th><th class=\"cl-0be61490\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">Valor</span><br><span class=\"cl-0bde4db4\">de Importancia</span><br><span class=\"cl-0bde4db4\">(%)</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Ocotea psychotrioides</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">4.53</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">35.19</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">12.68</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">5.86</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">53.73</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Carpinus caroliniana</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">9.77</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">12.02</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">12.68</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">24.11</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">48.80</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Quercus leiophylla</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">17.61</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">12.02</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">11.27</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">24.39</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">47.68</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Quercus germana</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">22.58</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">5.15</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">11.27</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">17.98</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">34.40</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Turpinia insignis</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">4.21</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">11.59</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">12.68</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">3.61</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">27.87</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Beilschmiedia mexicana</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">5.17</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">6.01</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">8.45</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">2.92</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">17.38</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Calyptranthes millspaughii</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">11.14</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">4.72</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">7.04</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">3.89</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">15.65</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Liquidambar styraciflua var. mexicana</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">22.67</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">2.58</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">5.63</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">5.30</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">13.50</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Mollinedia viridiflora</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">3.40</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">4.72</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">7.04</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">0.76</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">12.53</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Zinowiewia integerrima</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">19.40</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">2.15</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">1.41</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">4.71</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">8.26</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Quercus xalapensis</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">10.83</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">1.29</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">2.82</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">3.27</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">7.37</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Annona cherimola</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">9.00</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">1.29</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">2.82</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">1.01</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">5.11</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Clethra mexicana</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">20.00</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">0.43</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">1.41</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">0.98</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">2.82</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be61491\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Quercus corrugata</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">20.00</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">0.43</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">1.41</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">0.98</span></p></td><td class=\"cl-0be6149a\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">2.82</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0be614a4\"><p class=\"cl-0be5e8a8\"><span class=\"cl-0bde4db4\">Citrus aurantifolia</span></p></td><td class=\"cl-0be614a5\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">4.00</span></p></td><td class=\"cl-0be614a5\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">0.43</span></p></td><td class=\"cl-0be614a5\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">1.41</span></p></td><td class=\"cl-0be614a5\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">0.23</span></p></td><td class=\"cl-0be614a5\"><p class=\"cl-0be5e8bc\"><span class=\"cl-0bde4db4\">2.07</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n\n\n\n\n\n## Obtención de Datos Abiertos\n\nLas fuentes de datos, especialmente hoy, pueden ser muy variadas. Desde los datos que conseguimos directamente en campo a partir de mediciones directas o encuestas, hasta los datos que podemos obtener de _fuentes de datos abiertos_. Considero que será de tu interés explorar las distintas formas de interacción que las fuentes de datos implican para nuestros procesos de producción _científica reproducible_.\n\n![](img/Escalera-Open Access.png)\n\n### Manejo de claves confidenciales\n\nUn tema importante a cuidar es preservar la confidencialidad de claves, **tokens** y otras formas de identificación personal que puede implicar el proceso de acceso a datos en línea. Así que veremos eso como primer asunto. Queda claro que debemos evitar por todos los medios evitar poner esa información en carpetas o código que pueden acabar siendo registradas en Github en nuestro repositorio público. Haberte vacunado con `usethis::git_vaccinate()` ayuda en gran medida, pero desde luego no es remplazo a estar atentos a lo que estamos haciendo. La estrategia de registro de datos confidenciales que te propongo es la biblioteca `keyring`. Esta biblioteca accede al sistema de almacenamiento de credenciales de tu máquina desde _R_. La describen como una **API** _Independiente de la Plataforma_ para acceder al depósito de credenciales del sistema operativo de tu máquina. [Este sitio explica que es una API (Application Programming Interface)](https://aws.amazon.com/es/what-is/api/). Actualmente `keyring` soporta:  **Keychain** en _macOS_, **Credential Store** wn _Windows_, **the Secret Service API** en _Linux_, soluciones simples (sin plataforma específica) desarrollados con variables de sistema o archivos encristalados e incluso ofrece la posibilidad de desarrollar algunas soluciones propias con sencillez. En nuestro caso, básicamente usaremos dos funciones de esta biblioteca. Primero y desde la pantalla de **Consola** ejecuta:\n\\\n\n```r\nkey_set(service = \"[dale un nombre]\", username = \"[el que desees]\")\n```\n\\\n\nEsto hará el registro de tus credenciales en tu máquina, fuera de la vista. A partir de ese momento y mientras no elimines el registro explícitamente, estarán disponibles los datos que hayas registrado y los podrás obtener con: \n\\\n\n```r\nkey_ger(service = \"[dale un nombre]\", username = \"[el que desees]\")\n\n```\n\\\n\nEsta última línea recupera los datos confidenciales, así que deberás cuidar usar las credenciales de inmediato y procurar no guardarlas y menos desplegarlas o habilitar medios para mostrarlas, durante el proceso.\n\nVeamos un primer ejemplo con **INEGI**. Te sugiero ir a [https://www.inegi.org.mx/servicios/api_indicadores.html](https://www.inegi.org.mx/servicios/api_indicadores.html), en donde **INEGI** nos muestra un ejemplo de como acceder a los datos abiertos que _compilan_, _mantienen_ y _custodian_. Deberás obtener un **token** personal, el mismo sitio de **INEGI** te dirá como obtenerlo. El ejemplo muestra como obtener datos de la **serie histórica** del indicador de la **Población total** de los Estados Unidos Mexicanos, en idioma español, en formato _JSON_. Una vez que los obtengamos mostraremos los datos en tablas y gráficas.\n\nLo primero que haremos es preparar el acceso a los datos con el **token** confidencial y obtenemos los datos, sin haber registrado la _URL_ de acceso, pues como viste arriba, incluye tu **token**, así que habrá que manejarla con seguridad. El resultado de este _código_ es una estruuctra de datos que ya no contiene información confidencial.\n\n\n\n\n\n\n\n\n\n\nLa siguiente tarea que haremos ahora es simplemente arreglar los datos y ponerlos de la manera que requiero. Los datos son actualmente una base de datos _JSON_, que es una estructura parecida a un diccionario jerárquico, que tiene una etiqueta seguida de los datos que le corresponden. Aquí te muestro un fragmento de los datos de **INEGI** que obtuvimos. Es la sección etiquetada como _Header_. Podemos ver que esta etiqueta tiene como contenido los datos _Name_ y _email_, a su vez con sus respectivos datos.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndescrip <- fromJSON(datosGenerales[[1]])$Header\nprettify(toJSON(descrip))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n{\n    \"Name\": \"Datos compactos BISE\",\n    \"Email\": \"atencion.usuarios@inegi.org.mx\"\n}\n \n```\n\n\n:::\n:::\n\n\n\n\n\\\n\nAhora haremos algunas operaciones para arreglar los datos del _JSON_ en una tabla de tipo _data.frame_ (_tibble_ si optamos por una variante actual) en _R_. Los datos que nos interesan son los que están en la etiqueta _Series_ y dentro de estas _Series_ están las listas de _OBSERVATIONS_, que en este caso son 15.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# junta todo en un gran texto corrido\nflujoDatos <- paste(datosGenerales, collapse = \" \") \n\n# Obtiene la lista de observaciones \nflujoDatos <- fromJSON(flujoDatos) # Convierte al JSON a una lista de R\nflujoDatos <- flujoDatos$Series # Toma la sublista Series \nflujoDatos <- flujoDatos[[1]][\"OBSERVATIONS\"]\n\ncat(\"\\nNúmero de observaciones: \", length(flujoDatos[[1]]),\n    \"\\n\\nDatos en cada observación:\\n\",\n    paste(\"   \", names(flujoDatos[[1]][[1]]), collapse = \"\\n\"), sep = \"\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nNúmero de observaciones: 15\n\nDatos en cada observación:\n    TIME_PERIOD\n    OBS_VALUE\n    OBS_EXCEPTION\n    OBS_STATUS\n    OBS_SOURCE\n    OBS_NOTE\n    COBER_GEO\n```\n\n\n:::\n:::\n\n\n\n\nAhora convierto lista de listas en un tabla con los datos de población y año de censado.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf1 <- flujoDatos[[1]] %>% \n      sapply(., c) %>% \n      t() %>% \n      as_tibble() %>% \n      select(TIME_PERIOD, OBS_VALUE) %>% \n      mutate(TIME_PERIOD = as.integer(TIME_PERIOD),\n             OBS_VALUE = as.integer(OBS_VALUE))\n\n\ndf1 %>% flextable() %>% \n        colformat_int(j = 1, big.mark = \"\") %>% \n        set_header_labels(TIME_PERIOD = \"Año\", OBS_VALUE = \"Población\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-0ca3249a{}.cl-0c8f0b5e{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-0c963e92{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-0c96657a{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0c96658e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0c96658f{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-0ca3249a'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-0c96657a\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">Año</span></p></th><th class=\"cl-0c96657a\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">Población</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">1910</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">15,160,369</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">1921</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">14,334,780</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">1930</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">16,552,722</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">1940</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">19,653,552</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">1950</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">25,791,017</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">1960</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">34,923,129</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">1970</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">48,225,238</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">1980</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">66,846,833</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">1990</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">81,249,645</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">1995</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">91,158,290</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">2000</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">97,483,412</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">2005</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">103,263,388</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">2010</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">112,336,538</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">2015</span></p></td><td class=\"cl-0c96658e\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">119,938,473</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0c96658f\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">2020</span></p></td><td class=\"cl-0c96658f\"><p class=\"cl-0c963e92\"><span class=\"cl-0c8f0b5e\">126,014,024</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n\n\nAhora podemos ver los datos como una gráfica\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(df1, type = \"b\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n\nAhora con la biblioteca `ggplot2`\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nggplot(df1, aes(x = TIME_PERIOD, y = OBS_VALUE / 1000000)) +\n  geom_point(color = \"red\", size = 3, show.legend = FALSE) +\n  geom_line(color = \"blue\", show.legend = FALSE) +\n  ylab(\"Población (millones de habitantes)\") +\n  xlab(\"Año\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n\n\n\n## Contar historias con números\n\nEsta es una tarea usualmente complicada. A lo mejor la lectura de lo que propone [ Stephen Few](https://www.perceptualedge.com/articles/visual_business_intelligence/statistical_narrative.pdf), nos puede ayudar a profundizar esta reflexión.\n\n## Extensiones para Quarto\n\n_Quarto_, como _R_, es una pieza de software que propicia la colaboración abierta en su desarrollo, así que hay creciente núumero de extensiones. Algunas de ellas las [encuentras aqí](https://quarto.org/docs/extensions/listing-revealjs.html). Para el caso partticular de las presentaciones te interesará aprender [algunas técnicas avanzadas](https://quarto.org/docs/presentations/revealjs/advanced.html)\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/tabwid-1.1.3/tabwid.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}